<!-- public/atividades.html -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Search Academy – Atividades</title>
  <link rel="stylesheet" href="subcategorias-cards.css" />
  <!-- já usa suas classes de ícone (ex.: voluntariado--icon etc.) -->
</head>
<body>
  <header>
    <h1><span class="Search">Search</span> <span class="Academy">Academy</span></h1>
    <div class="search-bar">
      <input id="busca" type="text" placeholder="Qual atividade você procura?" />
    </div>
  </header>

  <div class="category-wrapper">
    <button class="scroll-btn left" id="btnLeft">&#8249;</button>
    <div class="category-container" id="categoryContainer"></div>
    <button class="scroll-btn right" id="btnRight">&#8250;</button>
  </div>

  <section class="cards" id="cardsSection"></section>

  <script>
    const elCategorias = document.getElementById('categoryContainer');
    const elCards = document.getElementById('cardsSection');
    const elBusca = document.getElementById('busca');

    let categorias = [];
    let atividades = [];
    let categoriaAtiva = 'todos';

    // Carregar dados do backend (seeded via Prisma)
    async function carregar() {
      const [catsRes, actsRes] = await Promise.all([
        fetch('/api/categorias'),
        fetch('/api/atividades'),
      ]);
      categorias = await catsRes.json();
      atividades = await actsRes.json();
      desenharCategorias();
      desenharCards();
    }

    // Renderiza todas as categorias numa única página
    function desenharCategorias() {
      elCategorias.innerHTML = '';

      // Botão "Todos"
      const btnTodos = document.createElement('div');
      btnTodos.className = `category ${categoriaAtiva === 'todos' ? 'active' : ''}`;
      btnTodos.dataset.slug = 'todos';
      btnTodos.innerHTML = `<span class="stash--search-solid"></span><span>Todos</span>`;
      btnTodos.addEventListener('click', () => selecionarCategoria('todos'));
      elCategorias.appendChild(btnTodos);

      // Demais categorias (do seed)
      categorias.forEach(c => {
        const el = document.createElement('div');
        el.className = `category ${categoriaAtiva === c.slug ? 'active' : ''}`;
        el.dataset.slug = c.slug;
        el.innerHTML = `<span class="${c.iconClass}"></span><span>${c.nome}</span>`;
        el.addEventListener('click', () => selecionarCategoria(c.slug));
        elCategorias.appendChild(el);
      });

      // Scroll setas
      document.getElementById('btnLeft').onclick  = () => elCategorias.scrollBy({ left: -200, behavior: 'smooth' });
      document.getElementById('btnRight').onclick = () => elCategorias.scrollBy({ left:  200, behavior: 'smooth' });
    }

    // Função de filtro: clicar em categoria -> mostra somente os cards dela
    function selecionarCategoria(slug) {
      categoriaAtiva = slug;
      desenharCategorias(); // atualiza estilo "active"
      desenharCards();      // re-render com filtro
    }

    // Busca por texto (título/descrição)
    elBusca.addEventListener('input', desenharCards);

    // Renderiza os cards com base na categoria ativa + busca
    function desenharCards() {
      const termo = elBusca.value?.toLowerCase().trim() || '';
      elCards.innerHTML = '';

      const filtradas = atividades.filter(a => {
        const condCat = categoriaAtiva === 'todos' || a.categoria?.slug === categoriaAtiva;
        const condTxt = !termo ||
          a.titulo.toLowerCase().includes(termo) ||
          a.descricao.toLowerCase().includes(termo);
        return condCat && condTxt;
      });

      if (filtradas.length === 0) {
        elCards.innerHTML = `<p style="padding:1rem;opacity:.7">Nenhuma atividade encontrada.</p>`;
        return;
      }

      filtradas.forEach(a => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${a.imagem || '/placeholder.jpg'}" alt="${a.titulo}" />
          <div class="card-content">
            <div class="card-title">${a.titulo}</div>
            <div class="card-description">${a.descricao}</div>
          </div>
          <button ${a.url ? `onclick="window.open('${a.url}','_blank')"` : ''}>SAIBA MAIS!</button>
        `;
        elCards.appendChild(card);
      });
    }

    carregar();
  </script>
</body>
</html>
